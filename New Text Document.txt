import os.path
import socket
import base64
from threading import Thread

port = 59000
localHost = "127.0.0.1"
format = 'utf-8'
byte_size = 1024

def handle_client(client_side,folder_name):

    while True:

        file_name = client_side.recv(byte_size).decode(format)
        path_path = os.path.join()

        if not file_name:
            break

        file_length = int(client_side.recv(byte_size).decode())

        with open(os.path.join(folder_name,file_name),"wb") as file:

            received_data = client_side.recv(file_length)
            file.write(received_data)

        print(f"File{file_name} received !")

    client_side.close()
def listen():

    server = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    server.bind((localHost,port)) # Create the TCP socket
    server.listen(5)
    print(f"server is listening on port:{port}...")

    folder_name = "received_file"

    while True:

        conn, addr = server.accept() # Accept incoming requests
        print(f"accepted connection from {addr}")
        clienthread = Thread(target=handle_client, args=(conn,folder_name))
        clienthread.start()

def main():
    listen()

main()