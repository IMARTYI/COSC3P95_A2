import socket
import os
import base64
import random
import string

port = 59000 # Port number
localHost = '127.0.0.1' # locally hosted address
format = 'utf-8' # This is the encoding format for transferring the data
size = 1024 # This is the byte size

def send_file(client_port,file_path):

    file_name = os.path.basename(file_path)

    client_port.send(file_name.encode(format))

    with open(file_path, "rb") as file:

        data = file.read(size)

        while data:
            client_port.send(data)
            data = file.read(size)

    print(f"File{file_name} sent to the server...")

# This will be a function to read the folder and send the folder contents to the server
def sendFolder(folder_path):

    client = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    client.connect((localHost,port)) # Created Client Socket

    folder_name = folder_path

    client.send(folder_name.encode(format))  # Send folder name

    for files in os.listdir(folder_path):

        file_path = os.path.join(folder_path,files)
        print(file_path)
        if os.path.isfile(file_path):
            print("in the if")
            send_file(client,file_path)


        print(f"{files} sent !")

    client.close()

    

#Function to populate the localFolder with 20 files with at least 5kbs of sizes DONT CALL THIS FUNCTION AGAIN !
def createFiles(folder_name):

    os.makedirs(folder_name,exist_ok=True)

    file_size = 5
    number_of_files =20

    for i in range(1,number_of_files+1):
        file_name = f"file{i}.txt"
        file_path = os.path.join(folder_name,file_name)

        # Generate random text content
        content = ''.join(random.choices(string.ascii_letters + string.digits, k=file_size * 1024))

        with open(file_path,'w') as file:
            file.write(content)


def main():

    path_to_folder = 'localFolder'

    #createFiles("localFolder")
    #print(os.path.abspath(path_to_folder))
    sendFolder(path_to_folder)

main()